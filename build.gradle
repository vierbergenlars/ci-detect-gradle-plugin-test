plugins {
    id "base"
    id "be.vbgn.ci-detect" version "0.3.0"
}

println System.getenv()
println ci.getClass().getName()

def assertEquals(message, expected, actual) {
    if(expected != actual) {
        throw new AssertionError("$message: Expected: $expected Actual: $actual")
    }
}

check {
    doLast {
        assertEquals("Is begin run on a CI server", true, ci.isCi())
        assertEquals("CI server branch is correct", project.findProperty("ci.branch"), ci.branch)

        assertEquals("CI server tag is set", !!project.hasProperty("ci.tag"), ci.isTag())
        assertEquals("CI server tag is correct", project.findProperty("ci.tag"), ci.tag)

        assertEquals("CI server pull request is set", !!project.hasProperty("ci.pr"), ci.isPullRequest())
        assertEquals("CI server pull request is correct", project.findProperty("ci.pr"), ci.pullRequest)
        assertEquals("CI server pull request target branch is correct", project.findProperty("ci.pr.targetBranch"), ci.pullRequestTargetBranch)
    }
}
